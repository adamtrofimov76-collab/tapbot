<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ğ¤ĞµÑ€Ğ¼Ğ° WebApp</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; max-width:680px; margin:0 auto; padding:16px; }
    .card { background:#1b1b1b; border-radius:12px; padding:12px; margin-bottom:12px; }
    button { width:100%; padding:12px; margin:6px 0; border:none; border-radius:10px; background:#2f80ed; color:#fff; font-size:16px; }
    .small { font-size:14px; opacity:0.85 }
    .top-item { padding:6px 0; border-bottom:1px solid #333; }
  </style>
</head>
<body>
  <h2>ğŸŒ¾ Ğ¤ĞµÑ€Ğ¼Ğ° â€” Web</h2>
  <div class="card">
    <label>Ğ’Ğ°Ñˆ Telegram user_id</label>
    <input id="uid" style="width:100%;padding:8px;border-radius:8px;border:1px solid #555;background:#222;color:#fff" />
    <button onclick="loadProfile()">ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ</button>
  </div>

  <div class="card">
    <div id="status">ĞĞ°Ğ¶Ğ¼Ğ¸ "ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ"</div>
    <div class="small" id="msg"></div>
  </div>

  <div class="card">
    <button id="tapBtn" onclick="doAction('/api/tap')">ğŸ‘‡ Ğ¢Ğ°Ğ¿</button>
    <button id="upTapBtn" onclick="doAction('/api/upgrade/tap')">âš¡ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ¿</button>
    <button id="upRegenBtn" onclick="doAction('/api/upgrade/regen')">ğŸš€ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ñ€ĞµĞ³ĞµĞ½</button>
    <button id="buyEnergyBtn" onclick="doAction('/api/buy-energy')">ğŸ’µ ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ</button>
    <button id="autoFarmBtn" onclick="doAction('/api/upgrade/auto-farm')">ğŸ¤– ĞĞ²Ñ‚Ğ¾-Ñ„Ğ°Ñ€Ğ¼</button>
  </div>

  <div class="card">
    <button onclick="loadTop('balance')">ğŸ’° Ğ¢Ğ¾Ğ¿ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ</button>
    <button onclick="loadTop('auto-farm')">ğŸ¤– Ğ¢Ğ¾Ğ¿ Ğ°Ğ²Ñ‚Ğ¾-Ñ„Ğ°Ñ€Ğ¼</button>
    <button onclick="loadTop('regen')">ğŸš€ Ğ¢Ğ¾Ğ¿ Ñ€ĞµĞ³ĞµĞ½</button>
    <div id="top"></div>
  </div>

<script>
  let userId = null;

  function body() { return { user_id: Number(userId) }; }

  function render(data) {
    document.getElementById('status').innerText =
      `ğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: ${data.balance}\nâš¡ Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ: ${data.energy}\nâš¡ Tap: ${data.tap_power}\nğŸš€ Ğ ĞµĞ³ĞµĞ½: ${data.energy_regen}/ÑĞµĞº\nğŸ¤– ĞĞ²Ñ‚Ğ¾-Ñ„Ğ°Ñ€Ğ¼: ${data.auto_farm_level}/ÑĞµĞº`;
    document.getElementById('msg').innerText = data.message;
    document.getElementById('upTapBtn').innerText = `âš¡ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ñ‚Ğ°Ğ¿ â€¢ ${data.costs.tap_upgrade}ğŸ’°`;
    document.getElementById('upRegenBtn').innerText = `ğŸš€ Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ñ€ĞµĞ³ĞµĞ½ â€¢ ${data.costs.regen_upgrade}ğŸ’°`;
    document.getElementById('autoFarmBtn').innerText = `ğŸ¤– ĞĞ²Ñ‚Ğ¾-Ñ„Ğ°Ñ€Ğ¼ â€¢ ${data.costs.auto_farm_upgrade}ğŸ’°`;
    document.getElementById('buyEnergyBtn').innerText = `ğŸ’µ ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ â€¢ ${data.costs.buy_energy}ğŸ’°`;
  }

  async function loadProfile() {
    userId = document.getElementById('uid').value.trim();
    if (!userId) return alert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ user_id');
    const r = await fetch('/api/profile', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body()) });
    const data = await r.json();
    if (!r.ok) return alert(data.detail || 'ĞÑˆĞ¸Ğ±ĞºĞ°');
    render(data);
  }

  async function doAction(url) {
    if (!userId) return alert('Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸ÑÑŒ');
    const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body()) });
    const data = await r.json();
    if (!r.ok) return alert(data.detail || 'ĞÑˆĞ¸Ğ±ĞºĞ°');
    render(data);
  }

  async function loadTop(kind) {
    const r = await fetch('/api/top/' + kind);
    const data = await r.json();
    const top = document.getElementById('top');
    top.innerHTML = `<h4>Ğ¢Ğ¾Ğ¿-5: ${kind}</h4>` + data.items.map((x,i)=>
      `<div class='top-item'>${i+1}. user_id=${x.user_id} | ğŸ’° ${x.balance} | ğŸ¤– ${x.auto_farm_level} | ğŸš€ ${x.energy_regen}</div>`
    ).join('');
  }
</script>
</body>
</html>
